package myio;

import java.io.*;

public class MyFile {

    /**
     * Ghi danh sách đối tượng vào file nhị phân
     *
     * @param filename tên của file cần ghi dữ liệu
     * @param objects  mảng các đối tượng cần ghi vào file
     * @throws IOException nếu có lỗi khi ghi vào file
     */
    public static void writeObjectsToFile(String filename, Object[] objects) throws IOException {
        try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(filename))) {
            for (Object obj : objects) {
                oos.writeObject(obj);
            }
        }
    }

    /**
     * Đọc danh sách đối tượng từ file nhị phân
     *
     * @param filename tên của file cần đọc dữ liệu
     * @return mảng các đối tượng được đọc từ file
     * @throws IOException            nếu có lỗi khi đọc từ file
     * @throws ClassNotFoundException nếu lớp của đối tượng đọc không được tìm thấy
     */
    public static Object[] readObjectsFromFile(String filename) throws IOException, ClassNotFoundException {
        try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(filename))) {
            // Đọc đối tượng từ file và thêm vào danh sách
            Object obj;
            int count = 0;
            while ((obj = ois.readObject()) != null) {
                count++;
            }

            // Đọc lại từ đầu của file và tạo mảng đối tượng
            ois.close();
            ois = new ObjectInputStream(new FileInputStream(filename));
            Object[] objects = new Object[count];
            for (int i = 0; i < count; i++) {
                objects[i] = ois.readObject();
            }
            
            return objects;
        }
    }

}
